# Apache Virtual Host Configuration for OMS Launch
# Option 1: Serve from root using VirtualHost or subdomain

<VirtualHost *:80>
    ServerName oms.example.com
    # Or use: ServerName example.com if serving from root

    DocumentRoot /var/www/oms_launch
    DirectoryIndex launch.php index.php index.html

    <Directory /var/www/oms_launch>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Enable rewrite engine
        RewriteEngine On

        # Don't rewrite files or directories that exist
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d

        # API endpoints
        RewriteRule ^api/(.*)$ api/$1 [L]
    </Directory>

    # Security: Prevent access to sensitive files
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>

    <FilesMatch "^(\.env|\.git|config\.php|schema\.sql)">
        Require all denied
    </FilesMatch>

    # PHP Configuration
    <FilesMatch "\.php$">
        SetHandler application/x-httpd-php
    </FilesMatch>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/oms_launch_error.log
    CustomLog ${APACHE_LOG_DIR}/oms_launch_access.log combined
</VirtualHost>

# For SSL/HTTPS (recommended for production):
# <VirtualHost *:443>
#     ServerName oms.example.com
#
#     DocumentRoot /var/www/oms_launch
#     DirectoryIndex launch.php index.php index.html
#
#     SSLEngine on
#     SSLCertificateFile /path/to/certificate.crt
#     SSLCertificateKeyFile /path/to/private.key
#     SSLCertificateChainFile /path/to/chain.crt
#
#     # Include same Directory configuration as above
#     <Directory /var/www/oms_launch>
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#         RewriteEngine On
#         RewriteCond %{REQUEST_FILENAME} !-f
#         RewriteCond %{REQUEST_FILENAME} !-d
#         RewriteRule ^api/(.*)$ api/$1 [L]
#     </Directory>
#
#     # Security headers
#     Header always set X-Content-Type-Options "nosniff"
#     Header always set X-Frame-Options "SAMEORIGIN"
#     Header always set X-XSS-Protection "1; mode=block"
#
#     ErrorLog ${APACHE_LOG_DIR}/oms_launch_ssl_error.log
#     CustomLog ${APACHE_LOG_DIR}/oms_launch_ssl_access.log combined
# </VirtualHost>
